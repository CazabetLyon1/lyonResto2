!<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>LYON FOOD</title>
    <meta name="viewport"  content="initial-scale=1, width=device-width, maximum-scale=1,user-scalable=no"/>
    <!--Mapbox-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.js"></script>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.css"/>
    <script src="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

    <link rel="stylesheet" href="styles/importer.less">
    <link rel="stylesheet" href="styles/index.css">
    <!--jQuery et jQuery-ui-->
	<script src ="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js"></script>
	<script src ="https://code.jquery.com/jquery-3.2.1.slim.min.js"></script>
  <script src ="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script src="https://code.jquery.com/jquery.js">

  <script src="http://code.jquery.com/jquery-1.9.1.js"></script>
  <script src="http://code.jquery.com/ui/1.10.3/jquery-ui.js"></script>



</head>
<body>
  <div class="col-lg-1"></div>
  <div class="col-md-10 jumbotron head-lyon">
    <p>Venez goûter à la cuisine lyonnaise</p>
    <h2>LYON FOOD</h2>

    <h3 class="head-guide">Votre guide de restaurants à Lyon</h3>
  <div class="col-lg-1"></div>

  </div>
  <div class="col-md-2"></div>
  <div class="col-md-8 jumbotron mid-img">
    <p>Lyon, capitale de la gastronomie</p>
    <p>"La vraie cuisine est une forme d'art, </p>
    <p>un cadeau à partager"</p>
    <p>Arnold Wesker</p>
  </div>



  <div class="content">
    <div class="col-md-2"></div>


    <div class="col-md-2"></div>
    <div class="col-md-8">
      <span>Recherche par nom/type</span>
      <input type="text" class="form-control" placeholder="Nom, Type..." id="txtSearch"/>

         <!-- <button class="btn btn-primary" type="submit">
         <span class="glyphicon glyphicon-search"></span>
         </button> -->

    </div>
    <div class="col-md-2"></div>




   <div class="row text-justify">
     <div class="col-md-2">

         <div class="row">

           <div class="col-md-12" align="center">
             <h2>Mes critères</h2>
           </div>
         </div>

         <div class="row">
           <div class="col-md-12">
             <div class="col-md-12" align="center">
               <h4 class="bg-info">NOM</h4>
             </div>
             <div class="input-group">

              <br />
             <br />
            </div>
           </div>

            <div class="col-md-12" align="center">
              <h4 class="bg-info">GENRE</h4>
            </div>
            <div>
              <input id="txtGenre" type="text" class="form-control" placeholder="Type of food..."/>
            </div>




           <div class="col-md-12" align="center">
             <h4 class="bg-info">RATING</h4>
           </div>

           <div class="col-md-12">
             <div class="star-rating">
               <span class="fa fa-star-o" data-rating="1"></span>
               <span class="fa fa-star-o" data-rating="2"></span>
               <span class="fa fa-star-o" data-rating="3"></span>
               <span class="fa fa-star-o" data-rating="4"></span>
               <span class="fa fa-star-o" data-rating="5"></span>
               <!-- <input type="hidden" name="whatever1" class="rating-value" value="2.56"> -->
             </div>
           </div>


           <div class="col-md-12" align="center">
             <h4 class="bg-info">Arrondissement</h4>
          </div>

          <div class="radio">
            <label><input name="arrondissement" id="arr1" type="radio" onclick="choixarrondissement(this.id)" >69001</label>
          </div>
          <div class="radio">
            <label><input name="arrondissement" id="arr2" type="radio" onclick="choixarrondissement(this.id)" >69002</label>
          </div>
          <div class="radio">
            <label><input name="arrondissement" id="arr3" type="radio" onclick="choixarrondissement(this.id)">69003</label>
          </div>
          <div class="radio">
            <label><input name="arrondissement" id="arr4" type="radio" onclick="choixarrondissement(this.id)">69004</label>
          </div>
          <div class="radio">
            <label><input name="arrondissement" id="arr5" type="radio" onclick="choixarrondissement(this.id)">69005</label>
          </div>
          <div class="radio">
            <label><input name="arrondissement" id="arr6" type="radio" onclick="choixarrondissement(this.id)" >69006</label>
          </div>
          <div class="radio">
            <label><input name="arrondissement" id="arr7" type="radio" onclick="choixarrondissement(this.id)">69007</label>
          </div>
          <div class="radio">
            <label><input name="arrondissement" id="arr8" type="radio" onclick="choixarrondissement(this.id)">69008</label>
          </div>
          <div class="radio">
            <label><input name="arrondissement" id="arr9" type="radio" onclick="choixarrondissement(this.id)">69009</label>
          </div>
          <div class="radio">
            <label><input name="arrondissement" id="arr10" type="radio" onclick="choixarrondissement(this.id)">69100</label>
          </div>
          <div class="radio">
            <label><input name="arrondissement" id="arr11" type="radio" onclick="choixarrondissement(this.id)">69110</label>
          </div>
          <div class="radio">
            <label><input name="arrondissement" id="arr12" type="radio" onclick="choixarrondissement(this.id)">69120</label>
          </div>
          <div class="radio">
            <label><input name="arrondissement" id="arr13" type="radio" onclick="choixarrondissement(this.id)">69200</label>
          </div>
          <div class="radio">
            <label><input name="arrondissement" id="arr14" type="radio" onclick="choixarrondissement(this.id)">69300</label>
          </div>
          <div class="radio">
            <label><input name="arrondissement" id="arr15" type="radio" onclick="choixarrondissement(this.id)">69500</label>
          </div>
          <button type="button" class="btn btn-secondary btn-lg btn-block" onclick="searchByGenre()">Search</button>
        </div>

       </div>
     <div class="col-md-7">
       <div id="mapid"></div>
     </div>
     <div class="col-md-3">
       <h2 id="name" style="text-align:center;"></h2>
       <div id="image">
         <img id="imageMarker" src="" style="width:100%">
       </div>
       <div id="markerInfos" hidden>
         <ul class="list-group">
          <!-- <li class="list-group-item">Name<span id="name" class="badge"></span></li> -->
          <li id="address" class="list-group-item">Address<span class="badge"></span></li>
          <li class="list-group-item">Type<span id="type" class="badge"></span></li>
          <li class="list-group-item">Rating<span id="rating" class="badge"></span></li>
          <li class="list-group-item">Number of reviews<span id="reviews" class="badge"></span></li>
          <li class="list-group-item">closed<span id="closed" class="badge"></span></li>
          <li class="list-group-item">Phone<span id="phone" class="badge"></span></li>
         </ul>
       </div>

     </div>
   </div>
 </div>

<script>

var map;

/*tableau qui contiendra tous les restaurants de lyon et alentour */
var resto=[];
/*tableau qui contiendra les markers des restaurants */
var mesMarkers=[];

var loc=[];

var btnRadio_selectionne = false;
var btnSearch = false;
var btnGenre = false;
var btnRating = false;

var tableResultats=[];

var tab_radio            = [];
var resultatsCLick = [];

var baseAdresse = [];

var tableArrondissement = [];
var tableArrondissement = { "arr1" : 69001, "arr2" : 69002, "arr3": 69003, "arr4": 69004, "arr5": 69005, "arr6": 69006, "arr7": 69007, "arr8": 69008,
"arr9": 69009, "arr10": 69100, "arr11": 69110,
"arr12": 69120, "arr13": 69200, "arr14": 69300, "arr15": 69500  };



  document.getElementById('mapid').innerHTML = "<div id='map' style='width: 100%; height: 100%;'></div>";
   map = L.map('map').setView([45.75, 4.85], 13);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{
      attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>',
      maxZoom: 17,
      minZoom: 4
   }).addTo(map);

   var layerGroup = L.layerGroup().addTo(map);


  $.getJSON('src/properResto.json', function (data) {

           resto=data;

           for(var i=0; i<resto.length; i++){
              if(resto[i] != null){
                baseAdresse.push(resto[i].location.address1);
              }
           }
           //console.log("base adresse", baseAdresse);
           displayDots(resto);

  });

     function displayDots(restochoisi){
          //console.log("displayDOT", restochoisi );
          for(var i=0; i<restochoisi.length; i++){
            //console.log(i);
            if(resto[i]!=null){
            //console.log(resto.length);
            //console.log(map);
            //console.log("resto[i] :",resto[i]);
              var details = {
              "name": restochoisi[i].name,
              "reviews": restochoisi[i].review_count,
              "type":restochoisi[i].categories[0].alias,
              "rating": restochoisi[i].rating,
              "status": restochoisi[i].is_closed,
              "image_url": restochoisi[i].image_url,
              "address": restochoisi[i].location.display_address,
              "phone": restochoisi[i].display_phone,
              };
              loc.push(details);

            var infos = 'Name: '+ restochoisi[i].name + ' Rating: '+ restochoisi[i].rating + ' phone: '+ restochoisi[i].display_phone ;
            var coordinates = {lat: restochoisi[i].coordinates.latitude, lng: restochoisi[i].coordinates.longitude};

          	 mesMarkers[i] = new L.marker(coordinates,loc[i]).bindPopup(infos).on('click',markerOnClick);
             mesMarkers[i].infos=details;
             layerGroup.addLayer(mesMarkers[i]);


             //console.log(marker[i]);

           }
          }
          //console.log("loc :",loc);
       }


      function markerOnClick(e){

		     //console.log("e :",e);
				 //console.log("e.target :",e.target);

		       document.getElementById("imageMarker").src = e.target.infos.image_url;
           document.getElementById("markerInfos").style.display = "block";
           document.getElementById("name").innerHTML = e.target.infos.name;
           document.getElementById("type").innerHTML = e.target.infos.type;
           document.getElementById("address").innerHTML = e.target.infos.address;
           document.getElementById("rating").innerHTML = e.target.infos.rating;
           document.getElementById("reviews").innerHTML = e.target.infos.reviews;
           document.getElementById("closed").innerHTML = e.target.infos.status;
           document.getElementById("phone").innerHTML = e.target.infos.phone;

		  }

           function supprimer(){
               //console.log("avant sdhzegv");
               layerGroup.eachLayer(function(layer){
                  map.removeLayer(layer);
               });

               //permet de décocher un bouton radio quand on sélectionne une nouvelle catégorie
               if(btnRadio_selectionne==true){
         				var arrondissement                              = tab_radio[0];
         				//document.getElementById(arrondissement).checked = false;
         				btnRadio_selectionne                  = false;
         				tab_radio                             = [];
               }
           }

           function toucheEntree (event){
             //Si la touche Entrée (dont le code ASCII est 13) a été appuyer alors on lance la fonction rechercher
               if(event.keyCode == 13){
                   rechercher();
               }
           }





                $(function(){
                  $("#txtSearch").autocomplete({
                    source: baseAdresse,
                    minLength: 2 // l'autocomplétion débutera au bout de 3 caractères
                  }).keyup(function(e){
                   toucheEntree(e);// gère l'évènement sur la touche entrée lorsque l'utilisateur à sélectionner une adresse dans la liste proposée par l'autocomplétion
                  });

                });
           function SearchByName(){
              var word = document.getElementById("txtSearch").value;
              console.log("word tape", word);
              var tableSearch = [];

              if(word != ""){
                btnSearch = true;

              }
              var found = false;
              for(var i=0; i<resto.length; i++){
                if(resto[i] != null &&  word == resto[i].location.address1){
                  tableSearch.push(resto[i]);
                  found = true;
                }
              }
              if(found == false){
                alert('Aucun résultat dans la base de donée pour votre recherche');
              }
              document.getElementById("txtSearch").value = ""; //Vide la barre de recherche
              return tableSearch;
           }

           function searchByGenre(){
             var word = document.getElementById("txtGenre").value;
             // console.log("document: ", document.getElementById("txtGenre"));
             console.log("genre tape", word);
             var tableGenre = [];

             if(word != ""){
               btnGenre = true;
             }

             var found = false;
             for(var i=0; i<resto.length; i++){
               if(resto[i] != null &&  word == resto[i].categories[0].alias){
                 tableGenre.push(resto[i]);
                 found = true;
               }

             }
             console.log("tableGenre", tableGenre);

             if(found == false){
               alert('Aucun résultat dans la base de donée pour votre recherche');
             }
             document.getElementById("txtGenre").value = ""; //Vide la barre de recherche
             return tableGenre;
           }





           function choixarrondissement(arrondissement){
               btnRadio_selectionne = true;
               tab_radio.push(arrondissement); // ajoute l'arrondissement dans le tableau
               supprimer();
               resultatsCLick= ajouterResto(arrondissement);
               console.log("resultatsCLick ", resultatsCLick);
               displayDots(resultatsCLick);


          }





        function ajouterResto(arrondissement){
          var tableau=[];
          var j;
          var cle;
          for(cle in tableArrondissement){
            if(arrondissement == document.getElementById(cle).id){
              j=cle;
              console.log("cle", j);
            }
          }

          for(var i=0; i<resto.length; i++){
            if(resto[i] != null){
              if(resto[i].location.zip_code == tableArrondissement[j]){
                tableau.push(resto[i]);
              }
            }
          }

          return tableau;
        }

        //ajouter une fonction pour supprimer les données de resultatsCLick
      function deleteTableResultats(){
        resultatsCLick.forEach(function(x){
          x="";
        });
        resultatsCLick = [];
      }


      function rechercher(){
        var tableauG=[];
        var tableauS=[];
        var tableauA=[];

        var total=[];

        if(btnSearch == true){
          tableauS=SearchByName();
          if(btnGenre == true){
            tableauG=searchByGenre(tableauS);
            btnRadio_selectionne = true;
            supprimer();
            total= ajouterResto(arrondissement, tableauG);
            console.log("total results ", total);
            displayDots(total);
          }

        }
        else{
          if(btnGenre == true){

          }
        }

      }






</script>

</body>
