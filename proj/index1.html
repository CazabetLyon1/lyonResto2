!<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>LYON FOOD</title>
    <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no"/>
    <!--Mapbox-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.js"></script>

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.1/dist/leaflet.css"
    integrity="sha512-Rksm5RenBEKSKFjgI3a41vrjkw4EVPlJ3+OiI65vTjIdo9brlAacEuKOiQ5OFh7cOI1bkDwLqdLw3Zg0cRJAAQ=="
    crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.3.1/dist/leaflet.js"
    integrity="sha512-/Nsx9X4HebavoBvEBuyp3I7od5tA0UzAxs+j83KgC8PU0kgB4XiK4Lfe4y4cgBtaRJQEIFCW+oC506aPT2L1zw=="
    crossorigin=""></script>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.css"/>
    <script src="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

    <link rel="stylesheet" href="/styles/importer.css">
    <link rel="stylesheet" href="/styles/index.css">
    <!--jQuery et jQuery-ui-->
	<script src ="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js"></script>
	<script src ="https://code.jquery.com/jquery-3.2.1.slim.min.js"></script>
  <script src ="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>


</head>
<body>

  <div class="content">
   <div class="row">
     <h1 class="head">Your places guide</h1>
   </div>
   <div class="row text-justify">
     <div class="col-md-2">
       <form onsubmit="" id="searchForm">
         <div class="row">
           <div class="col-md-12" align="center">
             <h2>Mes crit√®res</h2>
           </div>
         </div>

         <div class="row">
           <div class="col-md-12">
             <div class="col-md-12" align="center">
               <h4 class="bg-info">NOM</h4>
             </div>
             <div class="input-group">
              <input type="text" class="form-control" placeholder="NOM(restaurant, bars)..." id="txtSearch"/>
              <div class="input-group-btn">
                   <button class="btn btn-primary" type="submit">
                   <span class="glyphicon glyphicon-search"></span>
                 </button>
              </div>
            </div>
           </div>

            <div class="col-md-12" align="center">
              <h4 class="bg-info">RAYON</h4>
            </div>
            <div class="custom-control custom-checkbox col-md-12">
             <input type="checkbox" class="custom-control-input" id="customCheck1">
             <label class="custom-control-label" for="customCheck1"> 0 - 5 km</label>
            </div>

            <div class="custom-control custom-checkbox col-md-12">
              <input type="checkbox" class="custom-control-input" id="customCheck2">
             <label class="custom-control-label" for="customCheck1"> + 5 km</label>
           </div>

           <div class="col-md-12" align="center">
             <h4 class="bg-info">RATING</h4>
           </div>

           <div class="col-md-12">
             <div class="star-rating">
               <span class="fa fa-star-o" data-rating="1"></span>
               <span class="fa fa-star-o" data-rating="2"></span>
               <span class="fa fa-star-o" data-rating="3"></span>
               <span class="fa fa-star-o" data-rating="4"></span>
               <span class="fa fa-star-o" data-rating="5"></span>
               <!-- <input type="hidden" name="whatever1" class="rating-value" value="2.56"> -->
             </div>
           </div>
           </div>

       </form>
     </div>
     <div class="col-md-7">
       <div id="mapid"></div>
     </div>
     <div class="col-md-3">
       <h2 id="name" style="text-align:center;"></h2>
       <div id="image">
         <img id="imageMarker" src="" style="width:100%">
       </div>
       <div id="markerInfos" hidden>
         <ul class="list-group">
          <!-- <li class="list-group-item">Name<span id="name" class="badge"></span></li> -->
          <li id="address" class="list-group-item">Address<span class="badge"></span></li>
          <li class="list-group-item">Rating<span id="rating" class="badge"></span></li>
          <li class="list-group-item">Reviews number<span id="reviews" class="badge"></span></li>
          <li class="list-group-item">Status<span id="status" class="badge"></span></li>
          <li class="list-group-item">Phone<span id="phone" class="badge"></span></li>
         </ul>
       </div>

     </div>
   </div>
 </div>

<script>
var resto=[];
var map;
 function setGeolocalisation(cb){
   document.getElementById('mapid').innerHTML = "<div id='map' style='width: 100%; height: 100%;'></div>";
    map = L.map('map').setView([45.75, 4.85], 13);
   map.locate({setView:true, maxZoom:17});
   function onLocationFound(e) {
     console.log("Latlng: ", e);
      var radius = e.accuracy / 2;
      L.marker(e.latlng).addTo(map).bindPopup("Votre position actuelle").openPopup();
      L.circle(e.latlng, radius).addTo(map);
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{
          attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>',
          maxZoom: 17,
          minZoom: 4
       }).addTo(map);
       cb(e.latlng);
    }
    map.on('locationfound', onLocationFound);

    function onLocationError(e) {
    alert(e.message);
    }
    map.on('locationerror', onLocationError);

   map.on('popupopen', function(event){
     //event.popup.setContent('Name');
   });
   map.on('popupclose', function(event){
     event.popup.setContent('No data');
   });
 }

 $(document).ready(function() {

  setGeolocalisation(function(latlng){});


  $(document).on('submit', '#searchForm', function() {
    document.getElementById('mapid').innerHTML = "<div id='map' style='width: 100%; height: 100%;'></div>";
     map = L.map('map').setView([45.75, 4.85], 13);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{
        attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>',
        maxZoom: 17,
        minZoom: 4
     }).addTo(map);
    // do your things
    //latlng recupere les donnees du callback
    setGeolocalisation(function(latlng){
      //locs = valeur de retour
      //getData(latlng, function(locResto){
        //console.log("locResto: ", locResto);
        //console.log("Locs: ", locs);
        document.getElementById('mapid').innerHTML = "<div id='map' style='width: 100%; height: 100%;'></div>";
        // initialize the map
         map = L.map('map').setView([latlng.lat, latlng.lng], 13);
        var greenIcon = L.icon({
          iconUrl: '/images/location.png',
          //shadowUrl: 'leaf-shadow.png',

          iconSize:     [26, 80], // size of the icon
          shadowSize:   [50, 64], // size of the shadow
          iconAnchor:   [22, 94], // point of the icon which will correspond to marker's location
          shadowAnchor: [4, 62],  // the same for the shadow
          popupAnchor:  [-3, -76] // point from which the popup should open relative to the iconAnchor
        });
        //var markerPositionActuelle = L.marker((latlng), {icon: greenIcon}).bindPopup("Votre position").addTo(map);



        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{
            attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>',
            maxZoom: 17,
            minZoom: 4
         }).addTo(map);
      });
    });
    return false;
   });


   $.getJSON('src/properResto.json', function (data) {
            resto.push(data);
            console.log("resto: ",resto);
            console.log("1er element",resto[0][0]);
            console.log("2er element",resto[0][1]);

            displayDots();
        });

        //console.log("2er element",resto[0][1]);

        function markerOnClick(){

        }


 function displayDots(){
   var infos = 'Name: '+ resto[0][0].name + ' Rating: '+ resto[0][0].rating + 'phone: '+ resto[0][0].display_phone ;
   console.log(resto[0][0].coordinates);
   console.log(map);
    var marker = L.marker(resto[0][0].coordinates).bindPopup(infos).on('click', markerOnClick).addTo(map);

 }
        // var infos = 'Name: '+ resto[0][0].name + ' Rating: '+ resto[0][0].rating + 'phone: '+ resto[0][0].display_phone ;
         //var marker = L.marker(resto[0][0].coordinates).bindPopup(infos).on('click', markerOnClick).addTo(map);

        console.log("resto2: ",resto);
      //  console.log("coord :",resto[0].coordinates);

        /*for(var i=0; i<resto.length; i++){

          var infos = 'Name: '+ resto[i].name + ' Rating: '+ resto[i].rating + 'phone: '+ resto[i].display_phone ;
          var marker = L.marker(resto[i].coordinates).bindPopup(infos).on('click', markerOnClick).addTo(map);

        }*/

      /*  console.log(resto[0][0].name);

        resto.forEach(function(){
          var infos = 'Name: '+ resto.name + ' Rating: '+ resto.rating + 'phone: '+ resto.display_phone ;
          var marker = L.marker(resto.coordinates).bindPopup(infos).on('click', markerOnClick).addTo(map);
        })*/



</script>













</body>
